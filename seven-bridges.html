<!DOCTYPE HTML>
<html>
<head>
	<!-- Frameworks: jQuery and dat.gui -->
	<script src="js/jquery-1.7.2.min.js"></script>
	<script src="js/jquery-ui-1.8.18.custom.min.js"></script>
	<script type="text/javascript" src="js/dat.gui.js"></script>
	
	
	<!-- Graph Framework -->
	<script src="seven-bridges.js"></script>
	
	<!-- Tutorial overlay -->
	<script src="tutorial.js"></script>
	
	<!-- Styling -->
	<link rel=StyleSheet href="seven-bridges.css" title="stlyling">
	
	<!-- Build UI -->
	<script type="text/javascript">
		// Constants
		const INIT_NODE = 10;
		const INIT_DENSITY = 0.501;
		const INIT_SPEED = 4;
	
		// Global vars
		var graph = null;
		var animator = null;
		var controlData;
	
		// References to control divs
		var densityIndex = -1;
	
		// Initialization method (onload)
		window.onload = function() 
		{			
			// Initialize the dat-GUI
			var gui = new dat.GUI({ autoPlace: false });
			var customContainer = document.getElementById('gui');
			customContainer.appendChild(gui.domElement);
		
			// Object used for text data
			controlData = new GraphControls();
		
			// Event Listeners
			var densityController;
		
			// Build GUI
			var graphF = gui.addFolder('Graph');
			nodeController = graphF.add(controlData, "Nodes",0,100).step(1);
			densityController = graphF.add(controlData, "Density",0,1).listen(); // We listen to update when territory is chosen
			densityIndex = 1;
			graphF.add(controlData, "Generate");
			graphF.open();
		
			var simF = gui.addFolder('Simulation');
			speedController = simF.add(controlData, "Speed", 0,10);
			simF.add(controlData, "Stop");
			simF.open();	
			
			var algoF = gui.addFolder('Algorithm');
			algoF.add(controlData, "Flood");
			algoF.add(controlData, "CompleteElect");
			algoF.open();	
			
		
			// Generate a graph
			generateGraph();
		
		
			speedController.onChange(function(value) {
				controlData.Speed = value;
				if (animator != null)
					animator.setSpeedModifier(value);
			}); 
		
		
			// Add info toggle
			$('#info-toggle').on('click', function(e){
					$('#info-inner').stop(false, true).slideToggle(100);
					e.preventDefault();
				});
			$( "#alert" ).hide();
		
			tutorial();
		};
		// Data object used to populate GUI
		var GraphControls = function() 
		{
			this.Nodes = INIT_NODE;
		  	this.Density = INIT_DENSITY;
			this.Speed = INIT_SPEED;
		  	this.Generate = function() {
				generateGraph();
			};
		
			this.Flood = function () {
				if (animator != null) animator.stopAnimation();
				animator = null;
				animator = new Animator(graph,controlData.Speed);
				animator.broadcast();
			}

			this.CompleteElect = function () {
	            if (graph.isComplete()) {
					if (animator != null) animator.stopAnimation();
					animator = null;
					animator = new Animator(graph,controlData.Speed);
					animator.completeElect();
				} else {
					var slider = $("span:contains('Density')");
					var sliderLocation = slider.offset();
					$("#alert").css("top",""+(sliderLocation.top-15)+"px");
					$("#alert").css("left",""+(sliderLocation.left-240)+"px");
								
					$("#alert").show( "drop", {}, 100, callback);
					//$("#alert-arrow").show( "drop", {}, 500, callback);
				
					function callback() {
						setTimeout(function() {
							$( "#alert:visible" ).removeAttr( "style" ).fadeOut('fast',callback2);
							$("#alert").css("top",""+(sliderLocation.top-15)+"px");
							$("#alert").css("left",""+(sliderLocation.left-240)+"px");
						}, 3000 );
					};
				
					function callback2() {
						$("#alert").css("top",""+(sliderLocation.top-15)+"px");
						$("#alert").css("left",""+(sliderLocation.left-240)+"px");
					};
				}
			}

			this.Stop = function() {
				animator.stopAnimation();
			}
		};
	
	
	
		function generateGraph() {
			var canvas = document.getElementById('canvas');
			canvas.width  = window.innerWidth;
			canvas.height = window.innerHeight;
		
			canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
		
			if (animator != null) {
				animator.stopAnimation();
				animator.reset();
			}
		
			if (graph == null) graph = new Graph(canvas)
			generateArbitraryGraph(graph, canvas, controlData.Nodes, controlData.Density);			
		}
	</script>
	<title>SevenBridges Simulator</title>
</head>

<body>	
	<div id="overlay">
		<div id="tut1" class="tut alert border-g " style="top:0px;left:0px;">
			<div id="alert-inner" class="alert-inner"  width="120px">	
				<h1>Configure</h1>	
				<p>First, set the number of nodes and the edge density of the graph.</p>
			</div>
			<div id="alert-arrow" class="alert-arrow"> 
			</div>
		</div>
		
		<div id="tut2" class="tut alert border-g" style="top:0px;left:0px;">
			<div id="alert-inner" class="alert-inner"  width="120px">	
				<h1>Generate</h1>	
				<p>Then, click generate to create the graph.</p>
			</div>
			<div id="alert-arrow" class="alert-arrow"> 
			</div>
		</div>
		
		<div id="tut3" class="tut alert border-g" style="top:0px;left:0px;">
			<div id="alert-inner" class="alert-inner"  width="100px">	
				<h1>Simulate</h1>	
				<p>Change the speed at anytime to pause or speed up the execution.</p>
			</div>
			<div id="alert-arrow" class="alert-arrow"> 
			</div>
		</div>
		
		<div id="tut4" class="tut alert border-g" style="top:0px;left:0px;">
			<div id="alert-inner" class="alert-inner"  width="100px">	
				<h1>Algorithms</h1>	
				<p>Click on one of the algorithms to simulate it.</p>
			</div>
			<div id="alert-arrow" class="alert-arrow"> 
			</div>
		</div>
		
		<div id="tut5" class="tut alert border-g" style="top:0px;left:0px;">
			<div id="alert-inner" class="alert-inner"  width="100px">	
				<h1>Move it!</h1>	
				<p>Drag any node to move it around the screen!</p>
			</div>
		</div>
	</div>
	
	<div id="alert" class="border-r alert" style="top:0px;left:0px;">
		<div id="alert-inner" class="alert-inner"  width="100px">	
			<h1>Wait!</h1>	
			<p>First generate a complete graph by using a density of 1.</p>
		</div>
		<div id="alert-arrow" class="alert-arrow"> 
		</div>
	</div>
	
	
	<div id="gui"></div>
	<!-- Info pane by Jack Rugile -->
	<div id="info">
		<div id="info-inner">
			<h1>SevenBridges<span class="help">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:replayTutorial()" target="_blank">Help</a></span></h1>
			<p>Generate a graph using the Graph controls on the right, and simulate your favourite distributed algorithms from the Algorithm section. Click on a node to move it around. </p>	
			<p>By <a href="http://about.me/MattieuGA" target="_blank">Mattieu Gamache-Asselin </a></p>			
		</div>
		<a href="#" id="info-toggle">Toggle Info</a>
	</div>		
	
	<div id="canvasDiv">
		<canvas id="canvas" width="450px" height="600px"></canvas>
	</div>	
</body>

</html>








